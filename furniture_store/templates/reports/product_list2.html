{% extends "base.html" %}
{% load django_bootstrap5 %}
{% load custom_tags %}
{% block title %}
Матрица
{% endblock %}
{% block content %}
<h1 class="text-dark" style="margin-left: 20px; padding-top: 8px; margin-bottom: -2px;">Матрица</h1>
<hr>
<button type="button" class="btn btn-success" style="margin-top: 7px; margin-bottom: 7px; margin-left: 20px; border: 0; background-color: rgb(33, 115, 70); color: rgb(255, 255, 255);">Экспорт в Excel</button>
<hr class="my-0" style="position: sticky; width: 100%; top: 0;">
<table class="table table-hover table-lg table-responsive table-striped table-bordered">
    <thead>
        <tr class="table-light sticky-header">
            <th colspan="9"></th>
            <th colspan="3">Склады</th>
            {% for store in stores %}
                <th colspan="5">{{ store.name }}</th>
            {% endfor %}
        </tr>
        <tr class="sub-header">
            <th>Артикул</th>
            <th>Номенклатура</th>
            <th>Модель</th>
            <th>Производитель</th>
            <th>Площадь номенклатуры</th>
            <th><a href="?sort=category&order={% if current_sort == 'category' and current_order == 'asc' %}desc{% else %}asc{% endif %}" style="display: block; width: 100%; height: 100%; color: inherit; text-decoration: none;">Категория</a></th>
            <th>Сегмент</th>
            <th>Матрица</th>
            <th><a href="?sort=room_class&order={% if current_sort == 'room_class' and current_order == 'asc' %}desc{% else %}asc{% endif %}" style="display: block; width: 100%; height: 100%; color: inherit; text-decoration: none;">Комната</a></th>
            {% for warehouse in warehouses %}
                <th colspan="1">{{ warehouse.name }}</th>
            {% endfor %}
            {% for store in stores %}
                <th>План</th>
                <th>Факт</th>
                <th>Отклонение</th>
                <th>Площадь</th>
                <th>Комментарии</th>
            {% endfor %}
        </tr>
    </thead>
    <tbody>
    {% for product in products %}
        <tr>
            <td>{{ product.article }}</td>
            <td>{{ product.name }}</td>
            <td>{{ product.model }}</td>
            <td>{{ product.manufacturer }}</td>
            <td>{{ product.square }}</td>
            <td>{{ product.category }}</td>
            <td>{{ product.segment }}</td>
            <td>{{ product.matrix }}</td>
            <td>{{ product.room_class.name }}</td>
            {% for warehouse in warehouses %}
                <td>
                    {% with warehouse_item=warehouse_data|get_item:product.article|get_item:warehouse.id %}
                        {% if warehouse_item %}
                            {{ warehouse_item }}
                            {% else %}
                            0
                        {% endif %}
                    {% endwith %}
                </td>
            {% endfor %}
            {% for store in stores %}
                {% with exhibition=store_data|get_item:product.article|get_item:store.id %}
                    <td>{{ exhibition.plan_exhibition|default_if_none:"0" }}</td>
                    <td>{{ exhibition.fact_exhibition|default_if_none:"0"  }}</td>
                    <td>{{ exhibition.deviation|default_if_none:"0"  }}</td>
                {% endwith %}
                {% with doubled_quare=product.square|square %}
                    <td>{{ doubled_quare }}</td>
                {% endwith %}
                <td>
                    <a href="{% url 'reports:comments' store.id product.article %}" class="btn btn-info">Комментарии</a>
                </td>
            {% endfor %}
        </tr>
    {% endfor %}
    </tbody>
</table>
{% endblock %}





